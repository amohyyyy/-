<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ุจุฑููุงูู ุงูุทุงูุจ</title>
  <link rel="stylesheet" href="profile.css">
</head>
<body>
  <div class="layout">

    <!-- ุงููุงุฆูุฉ ุงูุฌุงูุจูุฉ -->
    <aside class="sidebar">
      <h2 class="logo">EduMath</h2>
      <nav>
        <ul>
          <li><a href="courses.html">๐ ุงูููุฑุณุงุช</a></li>
          <li><a href="results.html">๐ ุงููุชุงุฆุฌ</a></li>
          <li><a href="profile.html" class="active">๐ค ุจุฑููุงูู</a></li>
          <li><a href="index.html" id="logoutBtn">๐ช ุชุณุฌูู ุงูุฎุฑูุฌ</a></li>
        </ul>
      </nav>
    </aside>

    <!-- ุงููุญุชูู ุงูุฑุฆูุณู -->
    <main class="content">
      <header>
        <h1>ุจุฑููุงูู ุงูุทุงูุจ ๐ค</h1>
        <p>ููุง ุชูุฏุฑ ุชุนุฏู ุจูุงูุงุชู ุงูุดุฎุตูุฉ ูุชุฎุชุงุฑ ุตูุฑุชู ุงูุฑูุฒูุฉ.</p>
      </header>

      <section class="profile-card">
        <div class="avatar-section">
          <img id="avatarPreview" src="default-avatar.png" alt="ุฃูุงุชุงุฑ ุงูุทุงูุจ">
          <input type="file" id="avatarUpload" accept="image/*">
        </div>
        <div class="info-section">
          <p><strong>ุงูุงุณู:</strong> <span id="studentName">โ</span></p>
          <p><strong>ุงูุจุฑูุฏ ุงูุฅููุชุฑููู:</strong> <span id="studentEmail">โ</span></p>
          <p><strong>ุงูุณูุฉ ุงูุฏุฑุงุณูุฉ:</strong> <span id="studentGrade">โ</span></p>

          <button id="saveChanges">๐พ ุญูุธ ุงูุชุบููุฑุงุช</button>
        </div>
      </section>
    </main>
  </div>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-storage-compat.js"></script>
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyBvBlbWmFxN1t0Sv0TkWfcYndvgzq6499Y",
      authDomain: "edu-platform-35476.firebaseapp.com",
      projectId: "edu-platform-35476",
      storageBucket: "edu-platform-35476.firebasestorage.app",
      messagingSenderId: "823570222456",
      appId: "1:823570222456:web:656afb19407d955448cc8d",
      measurementId: "G-V7DZRJR57F"
    };
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();
    const storage = firebase.storage();

    // ุญูุงูุฉ ุงูุตูุญุฉ: ูู ูููุด ูุณุชุฎุฏู ูุฑุฌุน ูููุฌูู
    auth.onAuthStateChanged(async (user) => {
      if (!user) {
        window.location.href = "index.html";
      } else {
        document.getElementById("studentEmail").innerText = user.email;

        // ูุฑุงุกุฉ ุจูุงูุงุช ุงูุทุงูุจ ูู Firestore
        const doc = await db.collection("students").doc(user.uid).get();
        if (doc.exists) {
          const data = doc.data();
          document.getElementById("studentName").innerText = data.name || "ุจุฏูู ุงุณู";
          document.getElementById("studentGrade").innerText = data.grade || "โ";
          if (data.avatarUrl) {
            document.getElementById("avatarPreview").src = data.avatarUrl;
          }
        }
      }
    });

    // ุฑูุน ุตูุฑุฉ ุฃูุงุชุงุฑ ุฌุฏูุฏุฉ
    document.getElementById("avatarUpload").addEventListener("change", async (e) => {
      const file = e.target.files[0];
      const user = auth.currentUser;
      if (file && user) {
        const storageRef = storage.ref(`avatars/${user.uid}`);
        await storageRef.put(file);
        const url = await storageRef.getDownloadURL();
        document.getElementById("avatarPreview").src = url;
        await db.collection("students").doc(user.uid).set({ avatarUrl: url }, { merge: true });
      }
    });

    // ุฒุฑ ุญูุธ ุงูุชุบููุฑุงุช (ูููู ูุถูู ุชุนุฏูู ุจูุงูุงุช ูุงุญููุง)
    document.getElementById("saveChanges").onclick = () => {
      alert("ุชู ุญูุธ ุงูุชุบููุฑุงุช โ");
    };

    // ุฒุฑ ุชุณุฌูู ุงูุฎุฑูุฌ
    document.getElementById("logoutBtn").onclick = async (e) => {
      e.preventDefault();
      await auth.signOut();
      window.location.href = "index.html";
    };
  </script>
</body>
</html>
